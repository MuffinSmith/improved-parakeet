# Pentesting Week 3 Cheat Sheet

## Important Terms and References
### Terms

- **Pivot**: Pivoting is act of routing data _through_ a _pivot point_ in order to communicate with a target network.
  >**Example**: You can pivot to machines on subnets by **routing** through a host that _does_ have an interface, such as a router.

- **DMZ**: The `Demilitarized Zone` is a network that sits in-between the internet and the internal network of an organization. All interenet traffic must pass through the `DMZ` before being routed into the network.
  >**Example**: While DMZs add an extra layer of protection to a network, they are not impenetrable. Attackers can still exploit machines on the internal network by compromising a machine in the DMZ and using _it_ to send traffic to the intranet.

- **System privileges** are typically called **root privileges** on Linux.
  > **Example**: A **system shell**, or **root shell**, is one that runs with system privileges.

- **User Privileges**: Applications like Firefox and MS Word run with user privileges.
  > **Example**: By default, users only have privileges to modify files they own. They cannot make changes to other users' environments.

- **Administrator**: Administrators can modify anyone's files and application configurations, and have full privileges to reconfigure the system.
  > **Example**: Typically, gaining administrator privileges to a system is one of the first things an attacker tries to do.

- **Escalate Privileges**: This is the act of gaining administrator privledges on a compromised target.
  > **Example**: Once a system has been breached, an attacker attempts to escalate privileges so they have full control over the system.

- **SYSTEM**: When the WIndows OS runs a service that needs elevated privileges, it will run with `SYSTEM` privileges.
  > **Example**: `SYSTEM` privileges are identical to Administrator privileges in scope, but `SYSTEM` privileges are used only by the operating system, _not_ by user accounts.

- **Named Pipe**: "Pipes" in Windows are conceptually similar to those in Linux: They are simply a stream of data. Programs can use pipes to send data back and forth.
  >**Example**: A "named pipe" allows a running process to pass data to another. The process sending data is called a **pipe server**, and the recipient is called a **pipe client**.

- **Named Pipe Impersonation**: This is a Windows feature that enables a pipe _client_ to run commands with the same privileges as the pipe _server_.
  >**Example**: "Named pipes" allow a process to run with elevated privileges. If the pipe server has administrative privileges, _this means that a pipe client with user privileges can use named pipe impersonation to run commands with administrative privileges_.

- **Tokens** are pieces of data that systems use to authenticate users. On Windows, **Kerberos** is the most common token authentication protocol.
  >**Example**: When a user logs in, they are issued a unique token. They then pass this token along with future requests to prove their identity.

- **Token Duplication**: Metasploit is able to duplicate and re-use existing user tokens, allowing you to impersonate other authenticated users.
  > **Example**: Token duplication allows access to systems by using tokens that have been generated by other users.

- **NetBIOS**: A particular network transport that is part of the LAN Manager protocol suite. NetBIOS uses a broadcast communication style that was applicable to early segmented local area networks.
  >**Example**: A protocol family including name resolution, datagram, and connection services.


# Key Commands For The Week

### Metasploit

#### Searching Metasploit Modules

Metasploit has an overwhelming amount of modules. Being able to search them quickly and efficiently will help you save time.

```bash
# Search for Windows Modules
msf > search Windows
```

```bash
# Search for modules to gather information from a Windows machine
msf > search post/windows/gather
```

Use Metasploit's custom version of `grep` to narrow things down

```bash
# Search for `smb` within the results of post/windows/gather
msf > grep 'smb' search post/windows/gather
```


#### Using a Module

Once you have a module you want to try, you need to load it into Metasploit with the `use` command.

```bash
# Load the hashdump module
msf > use post/windows/gather/hashdump
```

After you load a module, you'll want to take a look at it's options.

```bash
# View the options of the currently loaded module
msf post(windows/gather/hashdump) > options
```

If you would like to unload your current module, use `back`

```bash
msf post(windows/gather/hashdump) > back
```

<details>
  <summary>Expand for more general Metasploit commands</summary>
  <ul>
    <li><code>set</code>Set an option
    <li><code>run</code>Run a module
    <li><code>run -j</code>Run a module in the background
    <li><code>db_nmap</code>run an Nmap scan and save it in the metasploit database
    <li><code>hosts</code>View hosts recorded in the database
    <li><code>services</code>View services recorded in the database
    <li><code>creds</code>View credentials recorded in the database
    <li><code>sessions</code>View meterpreter sessions recorded in the database
  </ul>
</details>


### Meterpreter

Once you have a Meterpreter session going, there are a number of commands available for you to gather more info from the victim.

```bash
# Attach to meterpreter session 1
msf > sessions -i 1
```
```bash
# Get the user ID and username of the current user
meterpreter > getuid
```
```bash
# Get the networking information
meterpreter > ifconfig
```

<details>
  <summary>Expand for more Meterpreter commands</summary>
  <ul>
    <li><code>?</code> View a list of Meterpreter commands
    <li><code>getprivs</code> escalate your privileges on the victim system
    <li><code>background</code> exit the meterpreter shell and return to msf (the meterpreter session stays open in the background)
    <li><code>download</code> download a file from the victim
    <li><code>upload</code> Upload a file to the victim
    <li><code>ls</code> list the files in a directory
    <li><code>cd</code> change directory
  </ul>
</details>

### Useful Metasploit Modules
The following modules are used _after_ you first obtain a Meterpreter session on a target machine. They are quite useful during the pillaging stage.

- `post/windows/gather/enum_services`: Enumerate service information. This is important for adequately profiling the target machine, as well as identifying opportunities for exploiting unquoted service paths for **privilege escalation**.

- `post/windows/gather/enum_shares`: Enumerate file shares.

- `post/windows/gather/win_privs`: Prints information about the privileges you have on your target machine. This includes whether you are currently logged in as a user, administrator, or as SYSTEM; whether UAC (User Access Control) is enabled; and information about any special permissions enabled for your current user.

- `post/windows/gather/credentials/sso`: Dump single sign-on credentials, in plaintext. This module requires you to have administrator privileges on your victim machine. If you have that, this module will dump usernames and passwords that you can use to sign into and/or authorize a wide variety of Windows services.

<details>
  <summary>Expand for other useful modules</summary>
  <ul>
    <li><code>post/windows/gather/hashdump</code> Dumps any username and NTLM hashes from system memory and saves them in the Metasploit database.
    <li><code>post/windows/gather/enum_domains</code> Finds active directory domains
    <li><code>post/windows/gather/enum_shares</code> Finds SMB file shares
    <li><code>post/windows/gather/enum_logged_on_users</code> Finds all users that are logged on to the machine.
    <li><code>post/windows/gather/enum_services</code> Finds all services running on the target machine.
    <li><code>post/windows/gather/forensics/browser_history</code> Finds browser history on the target machine.
  </ul>
</details>
